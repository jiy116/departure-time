<!DOCTYPE html>
<html>
    <head>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    </head>

<style>
#header {
    background-color:black;
    color:white;
    text-align:center;
    padding:5px;
}
</style>

<body>
    <div id="header">
        <h1>Find Your Bus</h1>
    </div>

<script>

getLocation();
function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(setPosition);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";
    }
}

function displaystop(stopobj){
    var div = document.createElement('div');
    div.className = 'stop';
    document.getElementsByTagName('body')[0].appendChild(div);
    div.innerHTML = "Stop Name: "+stopobj.title;

    var routelist = stopobj.routeprelist
    for (var i=0, len=routelist.length; i < len; i++) {
        var innerdiv = document.createElement('div');
        innerdiv.className = 'route';
        div.appendChild(innerdiv);
        displayroute(routelist[i],innerdiv)
    }
}

function displayroute(routeobj, div){
    var routetag = routeobj.routetag;
    div.innerHTML = 'Route: '+routetag;
    if(routeobj.hasdata==false){
        var innerdiv = document.createElement('div');
        div.appendChild(innerdiv);
        innerdiv.innerHTML = "Current bus is not available."
        return;
    }
    dirlist = routeobj.dirlist;
    for (var i=0, len=dirlist.length; i < len; i++) {
        var innerdiv = document.createElement('div');
        div.appendChild(innerdiv);
        innerdiv.className = 'direction';
        displaydir(dirlist[i], innerdiv);
    }
}


function displaydir(dir, div){
    var title = dir.title;
    div.innerHTML = 'Direction: '+title;

    //div.appendChild(innerdiv);

}

function setPosition(position) {

    var latitude = position.coords.latitude;
    var longitude = position.coords.longitude;
    $.getJSON('http://127.0.0.1:5000/stop.js?lon=-122.42199&lat=37.7728799', function(data){
        for (var i=0, len=data.length; i < len; i++) {
            displaystop(data[i])
        }   
    })
      .fail(function(){
        console.log( "error" );
    });
}

</script>

</body>
</html>
